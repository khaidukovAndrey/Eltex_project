# Библиотека для работы с конфигаруционным файлом для тегирования VLAN
Для работы с библиотекой необходимо подключить заголовочный файл *config_parser.h*<br/>

Файл конфигурации строится на списке соответствий "пул-тег". Пул представляет собой один или два IP-адреса, разделенных дефисом (-). IP-адрес записывается четырься десятичными числами, раздененных точками. Пример содержимого файла конфигурации:<br/>

*192.168.0.0-192.168.9.255-5<br/>
192.168.10.0-192.168.10.255-6<br/>
192.168.11.0-1024*<br/>

Данные об IP-адресах и тегах заносятся в следующую структуру:
```c
typedef struct tag_rules
{
    struct in_addr ip_left; // Левая граница пула
    struct in_addr ip_right; // Правая граница пула
    int tag; // Тег
} tag_rules_t;
```
Для работы с файлом и структурой используются следующие функции:
| Действие                                                                                       | Функция                                                  | Возвращаемое значение                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|------------------------------------------------------------------------------------------------|----------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Выделение памяти под структуру с указанаем её размера                                          | int tag_rules_init(tag_rules_t **, int)                  | 0 - успешное завершение<br/>-1 - неверный аргумент: непустой указатель  и/или неположительный размер<br/>-2 - ошибка при выделении памяти                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Очистка памяти, выделенной под структуру                                                       | int tag_rules_clear(tag_rules_t **)                      | 0 - успешное завершение<br/>-1 - неверный аргумент: пустой указатель                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Проверка данных структуры на наличие коллизий. Вторым параметр - размер структуры.             | int tag_rules_check_collisions(const tag_rules_t *, int) | 0 - успешное завершение<br/>>0 - количество найденных коллизий<br/>-1 - неверный аргумент: пустой указатель и/или неположительный размер<br/>-2 - ошибка при сравнении IP-адресов (функция ip_comparison в сonfig_parser.c)                                                                                                                                                                                                                                                                                                                                |
| Проверка существования файла конфигурации                                                      | int config_file_check(void)                              | 0 - успешное завершение<br/>-1 - ошибка при открытии файла<br/>-2 - ошибка при закрытии файла                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Чтение файла конфигурации и запись данных в структуру. Вторым параметр - размер структуры.     | int config_file_read(tag_rules_t *, int)                 | 0 - успешное завершение<br/>-1 - неверный аргумент: пустой указатель<br/>-2 - ошибка при открытии файла<br/>-3 - ошибка при чтении файла: количество правил превышает размер структуры<br/>-4 - ошибка при чтении файла - символы не считаны<br/>-5 - ошибка при чтении файла - недопустимое количество дефисов в правиле<br/>-6 - ошибка при чтении файла - часть правила пуста<br/>-7 - ошибка при конвертации IP-адреса в числовое представление (функция ip_converting в config_parser.c)<br/>-8 - ошибка при конвертации тега в числовое представление (функция tag_converting в config_parser.c)<br/>-9 - ошибка при закрытии файла |

Пример работы с библиотекой:
```c
#include "config_parser.h"
#include <stdio.h>
#include <stdlib.h>

int main(void)
{
    int res = config_file_check();
    if(res != 0)
    {
        printf("config_file_check: %d\n", res);
        return 1;
    }
 
    tag_rules_t* rules;
 
    res = tag_rules_init(&rules, 64);
    if(res != 0)
    {
        printf("tag_rules_init: %d\n", res);
        return 2;
    }
 
    int size = config_file_read(rules);
    if(res < 0)
    {
        printf("config_file_read: %d\n", res);
        return 3;
    }

    res = tag_rules_check_collisions(rules, size);
    printf("%d\n", res);

    tag_rules_clear(&rules);
 
    return 0;
}
```

