# VLAN-tagger
## Описание работы демона VLAN-tagger
VLAN-tagger - демон разработанный для обеспечения функционала тегирования. Основной задачей демона является применение VLAN меток к пакетам L3+ трафика в соответствии с заданными правилами тегирования, которые могут быть заданы в конфигурационном файле.
## Как запустить/уничтожить демон VLAN-tagger
Перед запуском программы необходимо выполнить сборку всего проекта. Перейдя в директорию с программой, выполните следующие команды в терминале:
1. Для сборки проекта введите команду: `make`
2. Добавьте в папку с проектом `vlan-tagger.cfg`
3. Затем, для запуска программы, введите следующую команду в терминале (замените `<interface_name>` на имя интерфейса, с которого будет слушаться весь L3+ поток пакетов): `sudo ./vlan_tagger <interface_name>`
   - Для уничтожения экземпляров демона запустите скрипт `kill_daemon.sh`
## Состав проекта
| Содержимое проекта                           | Роль в проекте              | Описание                                                                                                                                                                         |
|----------------------------------------------|-----------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [Queue](queue/README.MD)                     | Статическая библиотека      | Содержит описание очереди, используемой для обмена пакетами между потоками демона.                                                                                               |
| [Logger](logger/README.MD)                   | Статическая библиотека      | Логгер, который позволяет записывать в специальный лог-файл ошибки, предупреждения и данные касательно работы программы.                                                         |
| [Config parser](config_parser/README.MD)     | Статическая библиотека      | Позволяет производить парсинг текстового файла для ввода в программу правил тегирования, а также их проверки на корректность.                                                    |
| [Sniffer](sniffer.c)                         | 1 поток демона              | Сниффер реализованный при помощи RAW-сокетов. Сокет подключается к определенному интерфейсу (заданному в аргументе запуска), чтобы прослушивать трафик.                          |
| [Packet analyzer/VLAN tagger](vlan_tagger.c) | 2 поток демона              | Поток выполняющий функцию анализа полученных сниффером пакетов, а в дальнейшем присвоения определенного VLAN тега при удачном совпадении IP-адреса пакета с IP-адресами из пула. |
| [Sender](sender.c)                           | 3 поток демона              | Поток отправитель, который получая пакет из очереди от Packet analyzer/VLAN tagger, отправляет его обратно в сеть.                                                               |
| [Initializer](pthread_init.c)                | Инициализатор               | Содержит функции, осуществляющие инициализацию и запуск демона.                                                                                                                  |
| [Daemon killer](kill_daemon.sh)              | Скрипт для остановки демона | Данный скрипт позволяет уничтожить все существующие экземпляры демона                                                                                                            |   

## Пример работоспособности демона
После запуска демона, программой Wireshark было перехвачено два пакета:

| Полученный демоном пакет                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Отправленный демоном пакет                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0000   a8 a1 59 48 07 8b 54 c2 50 76 20 b8 08 00 45 a0<br/>0010   00 80 44 3a 40 00 3a 11 0b 34 42 16 ed 95 c0 a8<br/>0020   00 0b c3 60 e7 64 00 6c af 48 90 78 5f 87 ce 92<br/>0030   d2 e9 00 03 b1 84 be de 00 01 89 78 12 71 7d fb<br/>0040   df ed bf 52 0a 20 66 4a a5 d0 d5 63 70 bf bd 40<br/>0050   89 f0 95 8c 37 cf d1 98 1d b4 06 bf 09 91 c2 96<br/>0060   e7 4e b6 37 5a 30 c0 c2 75 34 5f e8 eb 91 de 95<br/>0070   5b 74 a2 00 0b ff 1f 89 4d 2d 88 93 9f 56 96 f6<br/>0080   20 24 21 fb 36 be ef ec 1f 77 b1 74 00 00 | 0000   a8 a1 59 48 07 8b 54 c2 50 76 20 b8 81 00 00 15<br/>0010   08 00 45 a0 00 80 44 3a 40 00 3a 11 0b 34 42 16<br/>0020   ed 95 c0 a8 00 0b c3 60 e7 64 00 6c af 48 90 78<br/>0030   5f 87 ce 92 d2 e9 00 03 b1 84 be de 00 01 89 78<br/>0040   12 71 7d fb df ed bf 52 0a 20 66 4a a5 d0 d5 63<br/>0050   70 bf bd 40 89 f0 95 8c 37 cf d1 98 1d b4 06 bf<br/>0060   09 91 c2 96 e7 4e b6 37 5a 30 c0 c2 75 34 5f e8<br/>0070   eb 91 de 95 5b 74 a2 00 0b ff 1f 89 4d 2d 88 93<br/>0080   9f 56 96 f6 20 24 21 fb 36 be ef ec 1f 77 b1 74<br/>0090   00 00 |

В данном сравнении пакетов можно заметить, что добавилось 4 байта `81 00 00 15`. Это подтверждает работоспособность программы.
